<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <!-- Meta viewport mejorado para evitar zoom accidental en móviles -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Navidad en tu Mesa - Catálogo 2025</title>

    <!-- Fuentes Google -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap" rel="stylesheet">

    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Header Fijo -->
    <header class="header-fijo">
        <div class="header-content">
            <div class="logo-section">
                <h1 class="logo-title">Navidad en tu Mesa</h1>
                <p class="logo-subtitle">Conjuntos Exclusivos</p>
            </div>
        </div>
    </header>

    <!-- Navegación Fija -->
    <nav class="navegacion-fija">
        <div class="nav-content">
            <button id="btn-anterior" class="nav-btn nav-btn-prev" disabled>
                <span>&larr;</span> Anterior
            </button>

            <div class="contador-paginas">
                <span id="pagina-actual">1</span> / <span id="total-paginas">5</span>
            </div>

            <button id="btn-siguiente" class="nav-btn nav-btn-next">
                Siguiente <span>&rarr;</span>
            </button>
        </div>
    </nav>

    <!-- Contenedor Principal -->
    <main class="main-container">
        <!-- Contenedor Flipbook -->
        <div id="flipbook-container" class="flipbook-container">
            <div id="flipbook" class="flipbook">
                <!-- Las páginas se generarán dinámicamente -->
            </div>
        </div>
    </main>

    <!-- Modal de Producto -->
    <div id="modal-producto" class="modal-overlay">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-titulo">
            <button class="modal-close" id="modal-close" aria-label="Cerrar">&times;</button>
            
            <div class="modal-body">
                <div class="modal-galeria">
                    <div class="galeria-contenedor">
                        <div class="galeria-item active" data-type="image">
                            <img id="modal-img" src="" alt="">
                        </div>
                        <div class="galeria-item" data-type="video" style="display: none;">
                            <video id="modal-video" controls preload="metadata">
                                <source src="" type="video/mp4">
                                Tu navegador no soporta videos.
                            </video>
                        </div>
                    </div>
                    <div class="galeria-navegacion">
                        <button class="galeria-btn galeria-prev" onclick="cambiarGaleriaItem(-1)">‹</button>
                        <div class="galeria-indicadores">
                            <span class="galeria-dot active" data-index="0" onclick="irAGaleriaItem(0)"></span>
                            <span class="galeria-dot" data-index="1" onclick="irAGaleriaItem(1)"></span>
                        </div>
                        <button class="galeria-btn galeria-next" onclick="cambiarGaleriaItem(1)">›</button>
                    </div>
                </div>
                
                <div class="modal-info">
                    <h2 id="modal-titulo" class="modal-titulo"></h2>
                    <p id="modal-codigo" class="modal-codigo"></p>
                    <p id="modal-incluye" class="modal-incluye"></p>
                    <p id="modal-descripcion" class="modal-descripcion"></p>
                    
                    <div class="modal-precio">
                        <span id="modal-precio-valor" class="precio-valor"></span>
                    </div>
                    
                    <div class="modal-acciones">
                        <a id="whatsapp-btn" class="whatsapp-btn" href="#" target="_blank" rel="noopener">
                            <span class="whatsapp-icon"></span>
                            Consultar por WhatsApp
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Firebase SDK v10.7.1 -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getFirestore, collection, getDocs, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        
        // Security Hardening: Credential Validation & Integrity Check
        function validateFirebaseConfig(config) {
            const requiredFields = ['apiKey', 'authDomain', 'projectId', 'storageBucket', 'messagingSenderId', 'appId'];
            const hasAllFields = requiredFields.every(field => config && config[field]);
            
            if (!hasAllFields) {
                throw new Error('Security: Invalid Firebase configuration');
            }
            
            // Domain validation
            const allowedDomains = ['localhost', '127.0.0.1', 'servilletasnavidenas.netlify.app'];
            const currentDomain = window.location.hostname;
            
            if (!allowedDomains.includes(currentDomain)) {
                throw new Error('Security: Unauthorized domain access');
            }
            
            return true;
        }
        
        // Initialize with security checks
        if (!window.FIREBASE_CONFIG) {
            throw new Error('Security: Firebase configuration not found');
        }
        
        validateFirebaseConfig(window.FIREBASE_CONFIG);
        const firebaseConfig = window.FIREBASE_CONFIG;
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // Make Firebase available globally
        window.firebaseApp = app;
        window.db = db;
        window.getDocs = getDocs;
        window.collection = collection;
        window.onSnapshot = onSnapshot;
    </script>
    
    <!-- Librería PageFlip (asegúrate que el CDN sea accesible desde tu entorno) -->
    <script src="https://unpkg.com/page-flip/dist/js/page-flip.browser.js"></script>
    <script src="script.js"></script>
</body>
</html>
